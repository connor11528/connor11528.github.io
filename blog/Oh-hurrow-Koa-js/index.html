<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta name="generator" content="Hexo 3.8.0"><meta name="author" content="Connor Leech"><title>Oh hurrow Koa.js</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="cleartype" content="on"><meta name="MobileOptimized" content="320"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="description" content="Koa is a Javascript HTTP server framework developed by TJ, the creator of express. It was meant to be the successor to the express npm package as it uses ES6 generators. This tutorial gets started with the framework through building a web server."><meta name="keywords" content="laravel, aws, javascript, php, developer, software engineer, web development, software, node.js, serverless, lambda, san francisco, bay area, east bay, vue, vuejs, vue.js, vue 2, laravel 5, amazon web services"><meta name="zipcode" content="94501"><meta name="city" content="Alameda"><meta name="state" content="California"><meta name="country" content="United States"><meta name="language" content="EN"><meta property="og:site_name" content="Connor Leech Blog | Javascript and Laravel tutorials"><meta property="og:description" content="Get notified about the latest trends in web development, career growth and cloud infrastructure. I send emails about twice a month covering tutorials in Javascript, Laravel and Cloud"><meta property="og:image" content="http://i0.kym-cdn.com/photos/images/original/001/018/899/936.jpg"><meta property="og:title" content="Oh hurrow Koa.js"><meta property="og:description" content="Koa is a Javascript HTTP server framework developed by TJ, the creator of express. It was meant to be the successor to the express npm package as it uses ES6 generators. This tutorial gets started with the framework through building a web server."><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70809574-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-70809574-1');
</script><!-- Favicon--><link rel="shortcut icon" type="image/png" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><!-- Vendor Fonts--><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/bower_components/animate.css/animate.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Yantramanav" rel="stylesheet"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries--><!-- WARNING: Respond.js doesn't work if you view the page via file://--><!--if lt IE 9script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
--><link rel="alternate" href="/atom.xml" title="config.title" type="application/rss2.xml"><link rel="stylesheet" href="/css/main.css"></head><body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top" class="post"><!-- Nav--><nav role="navigation" class="navbar navbar-custom navbar-fixed-top"><div class="container"><div class="navbar-header"><a href="https://employbl.com/" target="_blank" class="navbar-brand"><img src="/images/employbl_logo.svg" style="height:100px; width:100px;"></a><button type="button" data-toggle="collapse" data-target=".navbar-main-collapse" class="navbar-toggle"><i class="fa fa-bars"></i></button></div><div class="collapse navbar-collapse navbar-left navbar-main-collapse"></div><div class="collapse navbar-collapse navbar-right navbar-main-collapse"><ul class="nav navbar-nav"><li><a href="/blog" class="page-scroll">Blog ðŸ”¨</a></li><li><a href="/#about" class="page-scroll">Projects âš¡</a></li></ul></div></div></nav><main id="content"><div id="archive" class="container"><div class="row"> <div class="col-sm-2 col-md-2"><h3>Categories</h3><a href="/blog"><p>All</p></a><a href="/categories/Career"><p>Career</p></a><a href="/categories/Programming"><p>Programming</p></a><a href="/categories/Javascript"><p>Javascript</p></a><a href="/categories/Laravel"><p>Laravel</p></a><a href="/categories/Cloud"><p>Cloud</p></a><a href="/categories/PHP"><p>PHP</p></a></div><div class="col-xs-12 col-md-8"><article class="post"><div class="row"><div class="col-md-10 col-md-offset-1"><h1 class="post-title">Oh hurrow Koa.js</h1></div></div><div class="row"><div class="post-meta"><h5><span>Connor Leech</span><span class="date"> - Oct 23, 2015&ensp;in<span class="post-categories">&ensp;<a href="/categories/Javascript/" class="post-category">Javascript</a></span></span></h5><a target="_blank" href="http://twitter.com/intent/tweet?status=Oh hurrow Koa.js by @Connor11528+http://connorleech.info/blog/Oh-hurrow-Koa-js/" class="btn btn-primary social-share twitter"><i class="fa fa-twitter fa-2x"><span class="hidden-xs"></span></i></a><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://connorleech.info/blog/Oh-hurrow-Koa-js/&amp;title=Oh hurrow Koa.js&amp;source=connorleech.info" class="btn btn-primary social-share linkedin"><i class="fa fa-linkedin fa-2x"><span class="hidden-xs"></span></i></a></div></div><div class="post-body"><p>Koa is a node.js web framework that is more modern than express. We will build a functional web server in this tutorial </p>
<p><img src="https://camo.githubusercontent.com/674563115c4e0d4e5d99440b916952ad795c498e/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f363339363931332f6b6f612f6c6f676f2e706e67" alt=""></p>
<iframe src="https://ghbtns.com/github-btn.html?user=jasonshark&repo=koa-starter&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>

<iframe src="https://ghbtns.com/github-btn.html?user=koajs&repo=koa&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>

<p>Koa is a node.js web framework that is more modern than express. We will build a functional web server in this tutorial. Koa takes advantage of es6 features, like <a href="http://davidwalsh.name/es6-generators" target="_blank" rel="noopener">generators</a>. Generators do not actually generate anything. Read that article to get a gist (hint <code>yield</code> statements matter). Iâ€™ll be here when you get back.</p>
<p>Welcome back! To use this we need the newest version of node. Check with:</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span> <span class="title">-v</span></span><br><span class="line">v0.<span class="number">12.7</span></span><br></pre></td></tr></table></figure>
<p>Then to run our es6 code with <code>$ node --harmony server.js</code>. To not type that â€“harmony flag all the time add an alias to <strong>~/.bash_profile</strong>: </p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alias</span> <span class="title">node</span>=<span class="string">"node --harmony"</span></span><br><span class="line"><span class="keyword">alias</span> <span class="title">nodemon</span>=<span class="string">"nodemon --harmony"</span></span><br></pre></td></tr></table></figure>
<p>Harmony means ES6. Nodemon is for <a href="https://github.com/remy/nodemon" target="_blank" rel="noopener">nodemon</a>.</p>
<h3 id="Start-project"><a href="#Start-project" class="headerlink" title="Start project"></a>Start project</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir project-name</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> project-name &amp;&amp; npm init</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install koa koa-route --save</span></span><br></pre></td></tr></table></figure>
<p>Make a simple <strong>server.js</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">var</span> route = <span class="built_in">require</span>(<span class="string">'koa-route'</span>);</span><br><span class="line"><span class="keyword">var</span> app = koa();</span><br><span class="line"></span><br><span class="line"><span class="comment">// routes</span></span><br><span class="line">app.use(route.get(<span class="string">'/'</span>, index));</span><br><span class="line">app.use(route.get(<span class="string">'/about'</span>, about));</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6 generators expected as arguments</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">// this is a Koa Context</span></span><br><span class="line">	<span class="comment">// A Koa Context encapsulates nodeâ€™s request and response objects into a single object </span></span><br><span class="line">	<span class="keyword">this</span>.body = <span class="string">"&lt;h1&gt;Hello Koa!&lt;/h1&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">about</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Koa Context (this) has these properties: '</span>);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(<span class="keyword">this</span>));</span><br><span class="line">	<span class="keyword">this</span>.body = <span class="string">"&lt;h2&gt;This is the about route&lt;/h2&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8008</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Koa listening on port 8008'</span>);</span><br></pre></td></tr></table></figure>
<p>Here we see the es6 generators. Route callbacks expect generators, not regular functions. <code>this</code> in the generator is special in koa. It contains request and response as well as some other handy bits for web apps. When you hit the /about route you will see this:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Koa Context (<span class="keyword">this</span>) has these <span class="string">properties:</span> </span><br><span class="line">[ <span class="string">'request'</span>,</span><br><span class="line">  <span class="string">'response'</span>,</span><br><span class="line">  <span class="string">'app'</span>,</span><br><span class="line">  <span class="string">'req'</span>,</span><br><span class="line">  <span class="string">'res'</span>,</span><br><span class="line">  <span class="string">'onerror'</span>,</span><br><span class="line">  <span class="string">'originalUrl'</span>,</span><br><span class="line">  <span class="string">'cookies'</span>,</span><br><span class="line">  <span class="string">'accept'</span>,</span><br><span class="line">  <span class="string">'state'</span> ]</span><br></pre></td></tr></table></figure>
<p>Okay little different, nothing crazy. Next up we want to render some template files. ejs will be our template engine. <a href="https://github.com/tj/co-views" target="_blank" rel="noopener">co-views</a> has some config options for using jade or swig.. whatever that is.</p>
<p><code>$ npm install co-views ejs --save</code></p>
<p>Then in <strong>server.js</strong> add:</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> render = views(__dirname + <span class="string">'/views'</span>, &#123; <span class="attribute">ext</span>: <span class="string">'ejs'</span> &#125;);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.body = <span class="keyword">yield</span> render(<span class="string">'index'</span>, &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is similar to express. The empty object is data we can pass to the template engine. <code>co-body</code> acts like <code>body-parser</code> for incoming input so add that too.</p>
<p><code>$ npm install co-body --save</code></p>
<h4 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h4><p>Koa CRUD app: <a href="http://weblogs.asp.net/shijuvarghese/a-simple-crud-demo-with-koa-js" target="_blank" rel="noopener">http://weblogs.asp.net/shijuvarghese/a-simple-crud-demo-with-koa-js</a></p>
<p>Koa examples templates: <a href="https://github.com/koajs/examples/tree/master/templates" target="_blank" rel="noopener">https://github.com/koajs/examples/tree/master/templates</a></p>
<p>In the future we will implement OAuth with <a href="https://github.com/simov/grant" target="_blank" rel="noopener">grant</a> and I will build out a more full featured starter template.</p>
<p>Source code is <a href="https://github.com/jasonshark/koa-starter" target="_blank" rel="noopener">AVAILABLE HERE</a>.</p>
<iframe src="https://ghbtns.com/github-btn.html?user=jasonshark&repo=koa-starter&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
</div><div id="disqus_thread"></div></article><nav class="pagination"><a href="/blog/Make-a-deck-of-cards-with-Django/" title="Make a deck of cards with Django" class="btn-default entry-pagination__link entry-pagination__link--prev">Prev</a><a href="/blog/log-in-with-twitter-from-client-with-angular-and-oauth-io/" title="Client Side Twitter Login with Angular 1.x and OAuth.io" class="btn-default entry-pagination__link entry-pagination__link--next">Next</a></nav></div></div></div></main><footer class="footer"><div class="container"><div class="row"><div class="col-sm-6"><h4>Connor's Dev Newsletter</h4><p>Very occassional updates. You're free to sign up.</p><ul><li><form action="//herokuapp.us14.list-manage.com/subscribe/post?u=42dd73a709fbadb4a29ef1d0d&amp;amp;id=b77fdad58d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate="" class="validate"><div class="input-group"><input type="email" value="" name="EMAIL" id="mce-EMAIL" placeholder="Enter your email here" class="required email form-control input-lg"><div id="mce-error-response" style="display:none" class="response"></div><div id="mce-success-response" style="display:none" class="response"></div><div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_42dd73a709fbadb4a29ef1d0d_b77fdad58d" tabindex="-1" value=""></div><span class="input-group-btn"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn btn-primary btn-lg"></span></div></form></li></ul></div><div class="col-sm-2 col-sm-offset-1"><h4>Connect</h4><ul><li> <a target="_blank" href="https://github.com/connor11528">GitHub</a></li><li> <a target="_blank" href="https://www.linkedin.com/in/connorleech">LinkedIn</a></li><li> <a target="_blank" href="https://twitter.com/connor11528">Twitter</a></li><li><a target="_blank" href="https://medium.com/@connorleech">Medium</a></li><li><a target="_blank" href="https://stackoverflow.com/users/2031033/connor-leech">Stackoverflow</a></li><li><a target="_blank" href="https://plus.google.com/u/0/+ConnorLeech">Google+</a></li></ul></div><div class="col-sm-3"><h4>Email</h4><ul><li> <a href="mailto:connorleech@gmail.com">connorleech@gmail.com</a></li></ul></div></div></div></footer><!-- vendor--><script src="/bower_components/jquery/dist/jquery.min.js"></script><script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/bower_components/wow/dist/wow.min.js"></script><script src="/bower_components/jquery-easing/jquery.easing.min.js"></script><script src="/bower_components/jquery-color/jquery.color.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/ScrollMagic.min.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/plugins/debug.addIndicators.min.js"></script><script src="/bower_components/vivus/dist/vivus.min.js"></script><!-- require modules--><script src="/js/require.js"></script><script src="/js/app.js"></script><!-- analytics--><!-- disqus--><script>(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://connorleech.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></body></html>
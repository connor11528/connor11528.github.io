<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta name="generator" content="Hexo 3.8.0"><meta name="author" content="Connor Leech"><title>Part 3 - Add angular-ui-router to a Ruby On Rails app</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="cleartype" content="on"><meta name="MobileOptimized" content="320"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="description" content="In this post we add client side routing to a Ruby On Rails app using Angular 1.x"><meta name="keywords" content="laravel, aws, javascript, php, developer, software engineer, web development, software, node.js, serverless, lambda, san francisco, bay area, east bay, vue, vuejs, vue.js, vue 2, laravel 5, amazon web services"><meta name="zipcode" content="94501"><meta name="city" content="Alameda"><meta name="state" content="California"><meta name="country" content="United States"><meta name="language" content="EN"><meta property="og:site_name" content="Connor Leech Blog | Javascript and Laravel tutorials"><meta property="og:description" content="Get notified about the latest trends in web development, career growth and cloud infrastructure. I send emails about twice a month covering tutorials in Javascript, Laravel and Cloud"><meta property="og:image" content="http://i0.kym-cdn.com/photos/images/original/001/018/899/936.jpg"><meta property="og:title" content="Part 3 - Add angular-ui-router to a Ruby On Rails app"><meta property="og:description" content="In this post we add client side routing to a Ruby On Rails app using Angular 1.x"><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70809574-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-70809574-1');
</script><!-- Favicon--><link rel="shortcut icon" type="image/png" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><!-- Vendor Fonts--><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/bower_components/animate.css/animate.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Yantramanav" rel="stylesheet"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries--><!-- WARNING: Respond.js doesn't work if you view the page via file://--><!--if lt IE 9script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
--><link rel="alternate" href="/atom.xml" title="config.title" type="application/rss2.xml"><link rel="stylesheet" href="/css/main.css"></head><body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top" class="post"><!-- Nav--><nav role="navigation" class="navbar navbar-custom navbar-fixed-top"><div class="container"><div class="navbar-header"><a href="https://employbl.com/" target="_blank" class="navbar-brand"><img src="/images/employbl_logo.svg" style="height:100px; width:100px;"></a><button type="button" data-toggle="collapse" data-target=".navbar-main-collapse" class="navbar-toggle"><i class="fa fa-bars"></i></button></div><div class="collapse navbar-collapse navbar-left navbar-main-collapse"></div><div class="collapse navbar-collapse navbar-right navbar-main-collapse"><ul class="nav navbar-nav"><li><a href="/blog" class="page-scroll">Blog 🔨</a></li><li><a href="/#about" class="page-scroll">Projects ⚡</a></li></ul></div></div></nav><main id="content"><div id="archive" class="container"><div class="row"> <div class="col-sm-2 col-md-2"><h3>Categories</h3><a href="/blog"><p>All</p></a><a href="/categories/Career"><p>Career</p></a><a href="/categories/Programming"><p>Programming</p></a><a href="/categories/Javascript"><p>Javascript</p></a><a href="/categories/Laravel"><p>Laravel</p></a><a href="/categories/Cloud"><p>Cloud</p></a><a href="/categories/PHP"><p>PHP</p></a></div><div class="col-xs-12 col-md-8"><article class="post"><div class="row"><div class="col-md-10 col-md-offset-1"><h1 class="post-title">Part 3 - Add angular-ui-router to a Ruby On Rails app</h1></div></div><div class="row"><div class="post-meta"><h5><span>Connor Leech</span><span class="date"> - Dec 14, 2015&ensp;in<span class="post-categories">&ensp;<a href="/categories/Programming/" class="post-category">Programming</a></span></span></h5><a target="_blank" href="http://twitter.com/intent/tweet?status=Part 3 - Add angular-ui-router to a Ruby On Rails app by @Connor11528+http://connorleech.info/blog/Add-angular-ui-router-to-a-Ruby-On-Rails-app/" class="btn btn-primary social-share twitter"><i class="fa fa-twitter fa-2x"><span class="hidden-xs"></span></i></a><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://connorleech.info/blog/Add-angular-ui-router-to-a-Ruby-On-Rails-app/&amp;title=Part 3 - Add angular-ui-router to a Ruby On Rails app&amp;source=connorleech.info" class="btn btn-primary social-share linkedin"><i class="fa fa-linkedin fa-2x"><span class="hidden-xs"></span></i></a></div></div><div class="post-body"><p><strong>tldr;</strong> — <a href="https://github.com/cleechtech/rails-task-list" target="_blank" rel="noopener">source code on github</a> (give it a star!)</p>
<p>In <a href="http://connor11528.github.io/2015/12/02/Ruby-On-Rails-%E2%80%94-Introduction-for-the-total-n00b/" target="_blank" rel="noopener">part 1</a> and <a href="http://cleechtech.github.io/2015/12/04/Add-Angular-js-to-Ruby-on-Rails-app/" target="_blank" rel="noopener">part 2</a> we set up a Ruby On Rails app with some static data and added angular and bower. In this post we will set up routing and request the list of tasks using angular instead of the rails template language.</p>
<h3 id="Make-Rails-routes"><a href="#Make-Rails-routes" class="headerlink" title="Make Rails routes"></a>Make Rails routes</h3><p>In <strong>config/routes.rb</strong> we are going to set up the task index template as the route. Any request that is unmatched (as a fallback) will also serve the index template. Angular is on the index template so most routing our users see will happen through angular.</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  root <span class="keyword">:to</span> =&gt; <span class="string">"task#index"</span></span><br><span class="line">  <span class="builtin-name">get</span> <span class="string">"*unmatched_route"</span> =&gt; <span class="string">"task#index"</span></span><br><span class="line"> <span class="built_in">..</span>.</span><br></pre></td></tr></table></figure>
<p>Then in <strong>views/task/index.html.erb</strong> add a space where the routing will occur:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">class</span>=’container’&gt;</span><br><span class="line"> &lt;<span class="keyword">div</span> ui-view&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure>
<p>Next up we are going to use <a href="https://github.com/pitr/angular-rails-templates" target="_blank" rel="noopener">angular-rails-templates</a>. In the <strong>Gemfile</strong> add</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">gem</span> ‘<span class="selector-tag">angular-rails-templates</span>’</span><br><span class="line"><span class="selector-tag">gem</span> ‘<span class="selector-tag">sprockets</span>’, ‘2<span class="selector-class">.12</span><span class="selector-class">.3</span>’</span><br></pre></td></tr></table></figure>
<p>In order for this gem to work we need at least sprockets 2.12. The default sprockets for a rails 4 app (as of this writing is 2.11). You can update sprockets by running</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bundle update sprockets</span></span><br></pre></td></tr></table></figure>
<p>Side note, if you get an error when running bundle install with SSL certificates like:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Gem:</span>:<span class="string">RemoteFetcher:</span>:<span class="string">FetchError:</span> SSL_connect returned=<span class="number">1</span> errno=<span class="number">0</span> state=SSLv3 read server certificate <span class="string">B:</span> certificate verify failed (<span class="string">https:</span><span class="comment">//rubygems.org/gems/rack-1.5.5.gem)</span></span><br></pre></td></tr></table></figure>
<p>then change your gemfile to <code>source ‘http://rubygems.org&#39;</code> instead of <code>&#39;https://rubygems.org&#39;</code>. One letter change gets rid of the error.</p>
<h3 id="Write-angular-routes"><a href="#Write-angular-routes" class="headerlink" title="Write angular routes"></a>Write angular routes</h3><p>In <strong>app/assets/javascripts/application.js</strong> add the javascript libraries we need.</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/<span class="regexp">/= require angular/angular</span></span><br><span class="line">/<span class="regexp">/= require angular-ui-router/release</span><span class="regexp">/angular-ui-router</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/= require angular-rails-templates</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/= require_tree ../templates</span></span><br></pre></td></tr></table></figure>
<p>The last line here means that our client side templates live in <strong>app/assets/templates</strong>. So create that folder.</p>
<p>Next add a module dependency to angular and define our tasks route.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = angular.module(‘rails-task-<span class="keyword">list</span>’, [</span><br><span class="line"> ‘ui.router’,</span><br><span class="line"> ‘templates’</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">app.config([</span><br><span class="line"> ‘$stateProvider’, </span><br><span class="line"> ‘$urlRouterProvider’, </span><br><span class="line"> ‘$locationProvider’, </span><br><span class="line"> <span class="function"><span class="keyword">function</span><span class="params">($stateProvider, $urlRouterProvider, $locationProvider)</span></span>&#123;</span><br><span class="line">     $stateProvider.state(‘tasks’, &#123;</span><br><span class="line">          url: ‘/’,templateUrl: ‘tasks.html’,</span><br><span class="line">          controller: ‘TaskCtrl’</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    $urlRouterProvider.otherwise(‘/’);</span><br><span class="line">    $locationProvider.html5Mode(&#123;</span><br><span class="line">       enabled:<span class="keyword">true</span>,</span><br><span class="line">       requireBase: <span class="keyword">false</span></span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;]);</span><br></pre></td></tr></table></figure>
<p>Create <strong>app/assets/templates/tasks.html</strong></p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="string">div </span><span class="string">class=</span>’<span class="string">container’</span>&gt;</span><br><span class="line"> &lt;<span class="string">div </span><span class="string">class=</span>’<span class="string">row </span><span class="string">text-center’</span>&gt;</span><br><span class="line"> &lt;<span class="string">h2&gt;</span><span class="string">Task </span><span class="string">List&lt;</span>/<span class="string">h2&gt;</span></span><br><span class="line"> &lt;<span class="string">ul </span><span class="string">class=</span>’<span class="built_in">list-group’&gt;</span></span><br><span class="line"><span class="built_in"></span> &lt;<span class="string">li </span><span class="string">class=</span>’<span class="built_in">list-group-item’</span> <span class="string">ng-repeat=</span>’<span class="string">task </span><span class="string">in </span><span class="string">tasks’</span>&gt;</span><br><span class="line"> &#123;&#123;<span class="string">task.</span><span class="string">title&#125;</span>&#125;</span><br><span class="line"> &lt;/<span class="string">li&gt;</span></span><br><span class="line"> &lt;/<span class="string">ul&gt;</span></span><br><span class="line"> &lt;/<span class="string">div&gt;</span></span><br><span class="line">&lt;/<span class="string">div&gt;</span></span><br></pre></td></tr></table></figure>
<p>Now in our controller send the request for the tasks:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.controller(‘TaskCtrl’, [</span><br><span class="line"> ‘$scope’,</span><br><span class="line"> ‘$http’,</span><br><span class="line"> <span class="function"><span class="keyword">function</span><span class="params">($scope, $http)</span></span>&#123;</span><br><span class="line">     $scope.taks = [];</span><br><span class="line">     $http.get(‘/api/v1/tasks’).then(<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span><br><span class="line">         console.log(res.data);</span><br><span class="line">         $scope.tasks = res.data;</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>Send JSON with Rails Our angular routing is set up and we are ready to handle the JSON response. Now we need to set up the “/api/v1/tasks” endpoint. In <strong>config/routes.rb</strong> add our api definition.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">scope</span> ‘/api’ <span class="keyword">do</span></span><br><span class="line"> <span class="keyword">scope</span> ‘/v1’ <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">scope</span> ‘/tasks’ <span class="keyword">do</span></span><br><span class="line">     <span class="keyword">get</span> ‘/’ =&gt; ‘task#all’</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"> root :<span class="keyword">to</span> =&gt; “task#<span class="keyword">index</span>”</span><br><span class="line"> <span class="keyword">get</span> “*unmatched_route” =&gt; “task#<span class="keyword">index</span>”</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This says that when we hit “/api/v1/tasks” invoke the all method in TaskController. Remember, this is our rails task ctrl, not our angular task controller. Define the all method on the TaskController in <strong>app/controllers/task_controller.rb</strong> so that it looks like:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> &lt; ApplicationController</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">index</span></span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all</span></span></span><br><span class="line"> render <span class="symbol">json:</span> Task.all</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>So here the “index” method will render the html page. The “all” method will send all of the tasks to the client as json, then angular will render them. To see the raw JSON point your browser to <code>http://localhost:3000/api/v1/tasks</code>.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>In this tutorial we set up angular.js routing for our Ruby On Rails app. We serve client side templates and fetch data asynchronously using angular.js. You can <a href="https://github.com/cleechtech/rails-task-list" target="_blank" rel="noopener">check out the source code</a>. Give it a <a href="https://github.com/cleechtech/rails-task-list/stargazers" target="_blank" rel="noopener">star</a> if you find it helpful. Also you can ask me questions <a href="https://twitter.com/realjasonshark" target="_blank" rel="noopener">on twitter</a>.</p>
</div><div id="disqus_thread"></div></article><nav class="pagination"><a href="/blog/Create-a-custom-blog-theme-with-Hexojs/" title="Create a custom blog theme with Hexo.js" class="btn-default entry-pagination__link entry-pagination__link--prev">Prev</a><a href="/blog/Add-Angular-js-to-Ruby-on-Rails-app/" title="Part 2 - Add Angular.js to Ruby on Rails app" class="btn-default entry-pagination__link entry-pagination__link--next">Next</a></nav></div></div></div></main><footer class="footer"><div class="container"><div class="row"><div class="col-sm-6"><h4>Connor's Dev Newsletter</h4><p>Very occassional updates. You're free to sign up.</p><ul><li><form action="//herokuapp.us14.list-manage.com/subscribe/post?u=42dd73a709fbadb4a29ef1d0d&amp;amp;id=b77fdad58d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate="" class="validate"><div class="input-group"><input type="email" value="" name="EMAIL" id="mce-EMAIL" placeholder="Enter your email here" class="required email form-control input-lg"><div id="mce-error-response" style="display:none" class="response"></div><div id="mce-success-response" style="display:none" class="response"></div><div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_42dd73a709fbadb4a29ef1d0d_b77fdad58d" tabindex="-1" value=""></div><span class="input-group-btn"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn btn-primary btn-lg"></span></div></form></li></ul></div><div class="col-sm-2 col-sm-offset-1"><h4>Connect</h4><ul><li> <a target="_blank" href="https://github.com/connor11528">GitHub</a></li><li> <a target="_blank" href="https://www.linkedin.com/in/connorleech">LinkedIn</a></li><li> <a target="_blank" href="https://twitter.com/connor11528">Twitter</a></li><li><a target="_blank" href="https://medium.com/@connorleech">Medium</a></li><li><a target="_blank" href="https://stackoverflow.com/users/2031033/connor-leech">Stackoverflow</a></li><li><a target="_blank" href="https://plus.google.com/u/0/+ConnorLeech">Google+</a></li></ul></div><div class="col-sm-3"><h4>Email</h4><ul><li> <a href="mailto:connorleech@gmail.com">connorleech@gmail.com</a></li></ul></div></div></div></footer><!-- vendor--><script src="/bower_components/jquery/dist/jquery.min.js"></script><script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/bower_components/wow/dist/wow.min.js"></script><script src="/bower_components/jquery-easing/jquery.easing.min.js"></script><script src="/bower_components/jquery-color/jquery.color.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/ScrollMagic.min.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/plugins/debug.addIndicators.min.js"></script><script src="/bower_components/vivus/dist/vivus.min.js"></script><!-- require modules--><script src="/js/require.js"></script><script src="/js/app.js"></script><!-- analytics--><!-- disqus--><script>(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://connorleech.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></body></html>
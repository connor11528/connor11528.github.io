<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta name="generator" content="Hexo 3.8.0"><meta name="author" content="Connor Leech"><title>Email verification in a Laravel 5 app</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="cleartype" content="on"><meta name="MobileOptimized" content="320"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="description" content="When a user registers for your website keep their account inactive until they click a verification link that you send to their email address."><meta name="keywords" content="laravel, aws, javascript, php, developer, software engineer, web development, software, node.js, serverless, lambda, san francisco, bay area, east bay, vue, vuejs, vue.js, vue 2, laravel 5, amazon web services"><meta name="zipcode" content="94501"><meta name="city" content="Alameda"><meta name="state" content="California"><meta name="country" content="United States"><meta name="language" content="EN"><meta property="og:site_name" content="Connor Leech Blog | Javascript and Laravel tutorials"><meta property="og:description" content="Get notified about the latest trends in web development, career growth and cloud infrastructure. I send emails about twice a month covering tutorials in Javascript, Laravel and Cloud"><meta property="og:image" content="http://i0.kym-cdn.com/photos/images/original/001/018/899/936.jpg"><meta property="og:title" content="Email verification in a Laravel 5 app"><meta property="og:description" content="When a user registers for your website keep their account inactive until they click a verification link that you send to their email address."><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70809574-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-70809574-1');
</script><!-- Favicon--><link rel="shortcut icon" type="image/png" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><!-- Vendor Fonts--><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/bower_components/animate.css/animate.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Yantramanav" rel="stylesheet"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries--><!-- WARNING: Respond.js doesn't work if you view the page via file://--><!--if lt IE 9script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
--><link rel="alternate" href="/atom.xml" title="config.title" type="application/rss2.xml"><link rel="stylesheet" href="/css/main.css"></head><body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top" class="post"><!-- Nav--><nav role="navigation" class="navbar navbar-custom navbar-fixed-top"><div class="container"><div class="navbar-header"><a href="https://employbl.com/" target="_blank" class="navbar-brand"><img src="/images/employbl_logo.svg" style="height:100px; width:100px;"></a><button type="button" data-toggle="collapse" data-target=".navbar-main-collapse" class="navbar-toggle"><i class="fa fa-bars"></i></button></div><div class="collapse navbar-collapse navbar-left navbar-main-collapse"></div><div class="collapse navbar-collapse navbar-right navbar-main-collapse"><ul class="nav navbar-nav"><li><a href="/blog" class="page-scroll">Blog üî®</a></li><li><a href="/#about" class="page-scroll">Projects ‚ö°</a></li></ul></div></div></nav><main id="content"><div id="archive" class="container"><div class="row"> <div class="col-sm-2 col-md-2"><h3>Categories</h3><a href="/blog"><p>All</p></a><a href="/categories/Career"><p>Career</p></a><a href="/categories/Programming"><p>Programming</p></a><a href="/categories/Javascript"><p>Javascript</p></a><a href="/categories/Laravel"><p>Laravel</p></a><a href="/categories/Cloud"><p>Cloud</p></a><a href="/categories/PHP"><p>PHP</p></a></div><div class="col-xs-12 col-md-8"><article class="post"><div class="row"><div class="col-md-10 col-md-offset-1"><h1 class="post-title">Email verification in a Laravel 5 app</h1></div></div><div class="row"><div class="post-meta"><h5><span>Connor Leech</span><span class="date"> - Mar 27, 2018&ensp;in<span class="post-categories">&ensp;<a href="/categories/Laravel/" class="post-category">Laravel</a></span></span></h5><a target="_blank" href="http://twitter.com/intent/tweet?status=Email verification in a Laravel 5 app by @Connor11528+http://connorleech.info/blog/email-verification-in-a-laravel-5-app/" class="btn btn-primary social-share twitter"><i class="fa fa-twitter fa-2x"><span class="hidden-xs"></span></i></a><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://connorleech.info/blog/email-verification-in-a-laravel-5-app/&amp;title=Email verification in a Laravel 5 app&amp;source=connorleech.info" class="btn btn-primary social-share linkedin"><i class="fa fa-linkedin fa-2x"><span class="hidden-xs"></span></i></a></div></div><div class="post-body"><p>This app is going to send emails to verify that an email address is real when users sign up. Before their account is active users need
to click a special link that will verify their account and that they‚Äôre in control of that email address. This is a common 
web functionality we‚Äôve all experienced when signing up for new accounts online. The impetus for this project is that I deployed 
a Laravel app for people to use and put it behind a login form. Many people used garbage emails to sign up and access the app. 
This isn‚Äôt protected by default with Laravel‚Äôs auth scaffold, so let‚Äôs add it real quick!</p>
<blockquote>
<p>Draws heavily from <a href="https://hackernoon.com/how-to-use-queue-in-laravel-5-4-for-email-verification-3617527a7dbf" target="_blank" rel="noopener">this tutorial</a> by Ahmed Khan (<a href="https://github.com/ahmedkhan847" target="_blank" rel="noopener">@ahmedkhan847</a>)</p>
</blockquote>
<blockquote>
<p><a href="https://github.com/connor11528/laravel-email-verification" target="_blank" rel="noopener">Source code</a> is available for free on Github.</p>
</blockquote>
<h2 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h2><p>First step is to create a new Laravel app and generate the generic Laravel auth scaffold:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> php artisan make:auth</span></span><br></pre></td></tr></table></figure>
<h2 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h2><p>Head into the Laravel database migrations files and find the <strong>create_users_table</strong> migration. (Hint: it‚Äôs in <strong>database/migrations</strong>.) 
From there, add two columns to the users table for a token and an is verified field. The verified will default to zero for false.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Schema::create(<span class="string">'users'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">		$table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">		$table-&gt;string(<span class="string">'name'</span>);</span><br><span class="line">		$table-&gt;string(<span class="string">'email'</span>)-&gt;unique();</span><br><span class="line">		$table-&gt;string(<span class="string">'password'</span>);</span><br><span class="line">		$table-&gt;tinyInteger(<span class="string">'verified'</span>)-&gt;default(<span class="number">0</span>);</span><br><span class="line">		$table-&gt;string(<span class="string">'email_token'</span>)-&gt;nullable();</span><br><span class="line">		$table-&gt;rememberToken();</span><br><span class="line">		$table-&gt;timestamps();</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h2><p>Add a queue table for queued jobs and failed jobs, then migrate the database to set it all up.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> php artisan queue:table</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> php artisan queue:failed-table</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> php artisan migrate</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>If you get an error saying access denied, make sure you create a MySQL database for your Laravel app to connect to. You can do that by 
running <code>mysql -uroot -p</code> and then the sql command <code>create database laravelemailverification;</code>. Download something like <a href="https://www.sequelpro.com/" target="_blank" rel="noopener">Sequel Pro</a> 
to view your tables and database content.</p>
</blockquote>
<h2 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h2><p>For the migration to work you‚Äôll already have to have modified your <strong>.env</strong> file to connect to your database. Now we‚Äôre going to 
modify it to connect to a queue driver and mail driver. This is going to use the database as a queue driver and gmail for verification
emails.</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">APP_URL</span>=http://localhost:<span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">QUEUE_DRIVER</span>=database</span><br><span class="line"></span><br><span class="line"><span class="attr">MAIL_DRIVER</span>=smtp</span><br><span class="line"><span class="attr">MAIL_HOST</span>=smtp.gmail.com</span><br><span class="line"><span class="attr">MAIL_PORT</span>=<span class="number">587</span></span><br><span class="line"><span class="attr">MAIL_USERNAME</span>=connorleech@gmail.com</span><br><span class="line"><span class="attr">MAIL_PASSWORD</span>=</span><br><span class="line"><span class="attr">MAIL_ENCRYPTION</span>=tls</span><br><span class="line"><span class="attr">MAIL_FROM_ADDRESS</span>=connorleech@gmail.com</span><br><span class="line"><span class="attr">MAIL_FROM_NAME</span>=<span class="string">"Connor"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>For the new values to take effect you may need to run <code>php artisan config:clear</code></p>
</blockquote>
<blockquote>
<p>If you are sending emails from Gmail you‚Äôll have to turn off additional protections. Head to <a href="https://www.google.com/settings/security/lesssecureapps" target="_blank" rel="noopener">https://www.google.com/settings/security/lesssecureapps</a> and turn off
this setting. Without this, Google will block your Laravel app‚Äôs sign in attempts.</p>
</blockquote>
<h2 id="Step-5"><a href="#Step-5" class="headerlink" title="Step 5"></a>Step 5</h2><p>Create the email that you want to send to the user. There is a handy artisan command for scaffolding emails:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> php artisan make:mail EmailVerification</span></span><br></pre></td></tr></table></figure>
<p>That file is in <strong>app/Mail</strong> and can be modified to look like so: </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Mail</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Bus</span>\<span class="title">Queueable</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Mail</span>\<span class="title">Mailable</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Queue</span>\<span class="title">SerializesModels</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Queue</span>\<span class="title">ShouldQueue</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">EmailVerification</span> <span class="keyword">extends</span> <span class="title">Mailable</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">use</span> <span class="title">Queueable</span>, <span class="title">SerializesModels</span>;</span></span><br><span class="line"><span class="php">    </span></span><br><span class="line"><span class="php">    <span class="keyword">protected</span> $user;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Create a new message instance.</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($user)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;user = $user;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Build the message.</span><br><span class="line">     *</span><br><span class="line">     * @return $this</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">build</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;view(<span class="string">'email.verify_account'</span>)-&gt;with([</span></span><br><span class="line"><span class="php">            <span class="string">'email_token'</span> =&gt; <span class="keyword">$this</span>-&gt;user-&gt;email_token    </span></span><br><span class="line"><span class="php">        ]);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Step-6"><a href="#Step-6" class="headerlink" title="Step 6"></a>Step 6</h2><p>Create the email view within <strong>resources/views/email/verify_account.blade.php</strong>:</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;Click the <span class="keyword">Link</span> <span class="keyword">To</span> Verify Your Email&lt;/h3&gt;</span><br><span class="line">Click the following <span class="keyword">link</span> <span class="keyword">to</span> verify your email &#123;&#123; url(<span class="string">'/verifyemail/'</span> . $email_token) &#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Step-7"><a href="#Step-7" class="headerlink" title="Step 7"></a>Step 7</h2><p>Now we need to make a new job that will fire off the email:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> php artisan make:job SendVerificationEmail</span></span><br></pre></td></tr></table></figure>
<p>That job will live in <strong>app/Jobs</strong>. We pass in the user and send a verification email within this job. In order to have your queue active 
and listening for jobs you need a separate tab from your <code>php artisan serve</code> running <code>php artisan queue:work</code>. If you are making frontend changes 
you‚Äôre going to want to have <code>npm run watch</code> running in a third tab, but frontend Javascript is out of the scope of this tutorial.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Jobs</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Bus</span>\<span class="title">Queueable</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Queue</span>\<span class="title">SerializesModels</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Queue</span>\<span class="title">InteractsWithQueue</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Queue</span>\<span class="title">ShouldQueue</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Bus</span>\<span class="title">Dispatchable</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Mail</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Mail</span>\<span class="title">EmailVerification</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">SendVerificationEmail</span> <span class="keyword">implements</span> <span class="title">ShouldQueue</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">use</span> <span class="title">Dispatchable</span>, <span class="title">InteractsWithQueue</span>, <span class="title">Queueable</span>, <span class="title">SerializesModels</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">    <span class="keyword">protected</span> $user;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Create a new job instance.</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($user)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;user = $user;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Execute the job.</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        $email = <span class="keyword">new</span> EmailVerification(<span class="keyword">$this</span>-&gt;user);</span></span><br><span class="line"><span class="php">        Mail::to(<span class="keyword">$this</span>-&gt;user-&gt;email)-&gt;send($email);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Step-8"><a href="#Step-8" class="headerlink" title="Step 8"></a>Step 8</h2><p>Update the RegisterController.php:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Auth</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Hash</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Validator</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">RegistersUsers</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">Events</span>\<span class="title">Registered</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Jobs</span>\<span class="title">SendVerificationEmail</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">RegisterController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line">    /*</span><br><span class="line">    |--------------------------------------------------------------------------</span><br><span class="line">    | Register Controller</span><br><span class="line">    |--------------------------------------------------------------------------</span><br><span class="line">    |</span><br><span class="line">    | This controller handles the registration of new users as well as their</span><br><span class="line">    | validation and creation. By default this controller uses a trait to</span><br><span class="line">    | provide this functionality without requiring any additional code.</span><br><span class="line">    |</span><br><span class="line"><span class="php">    */</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">    <span class="keyword">use</span> <span class="title">RegistersUsers</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Where to redirect users after registration.</span><br><span class="line">     *</span><br><span class="line">     * @var string</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">protected</span> $redirectTo = <span class="string">'/home'</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Create a new controller instance.</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;middleware(<span class="string">'guest'</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Get a validator for an incoming registration request.</span><br><span class="line">     *</span><br><span class="line">     * @param  array  $data</span><br><span class="line">     * @return \Illuminate\Contracts\Validation\Validator</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">validator</span><span class="params">(array $data)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> Validator::make($data, [</span></span><br><span class="line"><span class="php">            <span class="string">'name'</span> =&gt; <span class="string">'required|string|max:255'</span>,</span></span><br><span class="line"><span class="php">            <span class="string">'email'</span> =&gt; <span class="string">'required|string|email|max:255|unique:users'</span>,</span></span><br><span class="line"><span class="php">            <span class="string">'password'</span> =&gt; <span class="string">'required|string|min:6|confirmed'</span>,</span></span><br><span class="line"><span class="php">        ]);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Create a new user instance after a valid registration.</span><br><span class="line">     *</span><br><span class="line">     * @param  array  $data</span><br><span class="line">     * @return \App\User</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">(array $data)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> User::create([</span></span><br><span class="line"><span class="php">            <span class="string">'name'</span> =&gt; $data[<span class="string">'name'</span>],</span></span><br><span class="line"><span class="php">            <span class="string">'email'</span> =&gt; $data[<span class="string">'email'</span>],</span></span><br><span class="line"><span class="php">            <span class="string">'password'</span> =&gt; Hash::make($data[<span class="string">'password'</span>]),</span></span><br><span class="line"><span class="php">            <span class="string">'email_token'</span> =&gt; base64_encode($data[<span class="string">'email'</span>]),</span></span><br><span class="line"><span class="php">        ]);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Handle a registration request for the application.</span><br><span class="line">     *</span><br><span class="line">     * @param \Illuminate\Http\Request $request</span><br><span class="line">     * @return \Illuminate\Http\Response</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">(Request $request)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;validator($request-&gt;all())-&gt;validate();</span></span><br><span class="line"><span class="php">        event(<span class="keyword">new</span> Registered($user = <span class="keyword">$this</span>-&gt;create($request-&gt;all())));</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">        dispatch(<span class="keyword">new</span> SendVerificationEmail($user));</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> view(<span class="string">'verification'</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line">    /**</span><br><span class="line">     * Handle a registration request for the application.</span><br><span class="line">     *</span><br><span class="line">     * @param $token</span><br><span class="line">     * @return \Illuminate\Http\Response</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify</span><span class="params">($token)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        $user = User::where(<span class="string">'email_token'</span>, $token)-&gt;first();</span></span><br><span class="line"><span class="php">        $user-&gt;verified = <span class="number">1</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>($user-&gt;save())&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">return</span> view(<span class="string">'emailconfirm'</span>, [<span class="string">'user'</span> =&gt; $user]);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Step-9"><a href="#Step-9" class="headerlink" title="Step 9"></a>Step 9</h2><p>and add the views‚Ä¶</p>
<p><strong>resources/views/email/verify_account.blade.php</strong></p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Click the <span class="keyword">Link</span> <span class="keyword">To</span> Verify Your Email&lt;/h1&gt;</span><br><span class="line">Click the following <span class="keyword">link</span> <span class="keyword">to</span> verify your email &#123;&#123; url(<span class="string">'/verifyemail/'</span> . $email_token) &#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>resources/views/verification.blade.php</strong></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@extends</span>(<span class="string">'layouts.app'</span>)</span><br><span class="line"><span class="variable">@section</span>(<span class="string">'content'</span>)</span><br><span class="line">    &lt;div class=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">"row"</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">"col-md-8 col-md-offset-2"</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">"panel panel-default"</span>&gt;</span><br><span class="line">                &lt;div class=<span class="string">"panel-heading"</span>&gt;Registration&lt;/div&gt;</span><br><span class="line">                &lt;div class=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">                    You have successfully registered. An email is sent to you for verification.</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"><span class="variable">@endsection</span></span><br></pre></td></tr></table></figure>
<p><strong>resources/views/emailconfirm.blade.php</strong></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@extends</span>(<span class="string">'layouts.app'</span>)</span><br><span class="line"><span class="variable">@section</span>(<span class="string">'content'</span>)</span><br><span class="line">    &lt;div class=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">"row"</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">"col-md-8 col-md-offset-2"</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">"panel panel-default"</span>&gt;</span><br><span class="line">                &lt;div class=<span class="string">"panel-heading"</span>&gt;Registration Confirmed&lt;/div&gt;</span><br><span class="line">                &lt;div class=<span class="string">"panel-body"</span>&gt;</span><br><span class="line">                    Your Email is successfully verified. Click here to &lt;a href=<span class="string">"&#123;&#123; url('/login') &#125;&#125;"</span>&gt;login&lt;/a&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"><span class="variable">@endsection</span></span><br></pre></td></tr></table></figure>
<h2 id="Fin"><a href="#Fin" class="headerlink" title="Fin!"></a>Fin!</h2><p>That‚Äôs it! Register for your application locally and you‚Äôll be redirected to the ‚Äúwe sent you an email screen‚Äù. Check your email, click the link 
and your account will be verified. From there you‚Äôll be able to login successfully. All of our testing here is done locally. To get your application
live to the internet you could <a href="http://connorleech.info/blog/Deploy-a-Laravel-5-app-to-Heroku/">deploy to heroku</a>. As an exercise for the reader you 
could switch your queue driver to Redis with Laravel Horizon, or leave it as is and start building the rest of your app.</p>
<p>If you have any questions shoot me an email (above) or hit me up on <a href="https://twitter.com/Connor11528" target="_blank" rel="noopener">twitter</a>.</p>
<blockquote>
<p><a href="https://github.com/connor11528/laravel-email-verification" target="_blank" rel="noopener">Source code</a> is available for free on Github.</p>
</blockquote>
</div><div id="disqus_thread"></div></article><nav class="pagination"><a href="/blog/Build-a-quick-admin-panel-in-Laravel-5/" title="Build an admin panel using Laravel 5" class="btn-default entry-pagination__link entry-pagination__link--next">Next</a></nav></div></div></div></main><footer class="footer"><div class="container"><div class="row"><div class="col-sm-6"><h4>Connor's Dev Newsletter</h4><p>Very occassional updates. You're free to sign up.</p><ul><li><form action="//herokuapp.us14.list-manage.com/subscribe/post?u=42dd73a709fbadb4a29ef1d0d&amp;amp;id=b77fdad58d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate="" class="validate"><div class="input-group"><input type="email" value="" name="EMAIL" id="mce-EMAIL" placeholder="Enter your email here" class="required email form-control input-lg"><div id="mce-error-response" style="display:none" class="response"></div><div id="mce-success-response" style="display:none" class="response"></div><div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_42dd73a709fbadb4a29ef1d0d_b77fdad58d" tabindex="-1" value=""></div><span class="input-group-btn"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn btn-primary btn-lg"></span></div></form></li></ul></div><div class="col-sm-2 col-sm-offset-1"><h4>Connect</h4><ul><li> <a target="_blank" href="https://github.com/connor11528">GitHub</a></li><li> <a target="_blank" href="https://www.linkedin.com/in/connorleech">LinkedIn</a></li><li> <a target="_blank" href="https://twitter.com/connor11528">Twitter</a></li><li><a target="_blank" href="https://medium.com/@connorleech">Medium</a></li><li><a target="_blank" href="https://stackoverflow.com/users/2031033/connor-leech">Stackoverflow</a></li><li><a target="_blank" href="https://plus.google.com/u/0/+ConnorLeech">Google+</a></li></ul></div><div class="col-sm-3"><h4>Email</h4><ul><li> <a href="mailto:connorleech@gmail.com">connorleech@gmail.com</a></li></ul></div></div></div></footer><!-- vendor--><script src="/bower_components/jquery/dist/jquery.min.js"></script><script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/bower_components/wow/dist/wow.min.js"></script><script src="/bower_components/jquery-easing/jquery.easing.min.js"></script><script src="/bower_components/jquery-color/jquery.color.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/ScrollMagic.min.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/plugins/debug.addIndicators.min.js"></script><script src="/bower_components/vivus/dist/vivus.min.js"></script><!-- require modules--><script src="/js/require.js"></script><script src="/js/app.js"></script><!-- analytics--><!-- disqus--><script>(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://connorleech.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></body></html>
<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta name="generator" content="Hexo 3.8.0"><meta name="author" content="Connor Leech"><title>Use Express, Angular 1.x and JWT to make a secure app</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="cleartype" content="on"><meta name="MobileOptimized" content="320"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="description" content="Use JSON Web Tokens (JWT) to secure a Mongo, Express, Angular and Node.js application.. affectionately known as the MEAN stack. JWT are stateless so can be used to secure APIs that communicate with multiple applications."><meta name="keywords" content="laravel, aws, javascript, php, developer, software engineer, web development, software, node.js, serverless, lambda, san francisco, bay area, east bay, vue, vuejs, vue.js, vue 2, laravel 5, amazon web services"><meta name="zipcode" content="94501"><meta name="city" content="Alameda"><meta name="state" content="California"><meta name="country" content="United States"><meta name="language" content="EN"><meta property="og:site_name" content="Connor Leech Blog | Javascript and Laravel tutorials"><meta property="og:description" content="Get notified about the latest trends in web development, career growth and cloud infrastructure. I send emails about twice a month covering tutorials in Javascript, Laravel and Cloud"><meta property="og:image" content="http://i0.kym-cdn.com/photos/images/original/001/018/899/936.jpg"><meta property="og:title" content="Use Express, Angular 1.x and JWT to make a secure app"><meta property="og:description" content="Use JSON Web Tokens (JWT) to secure a Mongo, Express, Angular and Node.js application.. affectionately known as the MEAN stack. JWT are stateless so can be used to secure APIs that communicate with multiple applications."><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70809574-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-70809574-1');
</script><!-- Favicon--><link rel="shortcut icon" type="image/png" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><!-- Vendor Fonts--><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/bower_components/animate.css/animate.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Yantramanav" rel="stylesheet"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries--><!-- WARNING: Respond.js doesn't work if you view the page via file://--><!--if lt IE 9script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
--><link rel="alternate" href="/atom.xml" title="config.title" type="application/rss2.xml"><link rel="stylesheet" href="/css/main.css"></head><body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top" class="post"><!-- Nav--><nav role="navigation" class="navbar navbar-custom navbar-fixed-top"><div class="container"><div class="navbar-header"><a href="https://employbl.com/" target="_blank" class="navbar-brand"><img src="/images/employbl_logo.svg" style="height:100px; width:100px;"></a><button type="button" data-toggle="collapse" data-target=".navbar-main-collapse" class="navbar-toggle"><i class="fa fa-bars"></i></button></div><div class="collapse navbar-collapse navbar-left navbar-main-collapse"></div><div class="collapse navbar-collapse navbar-right navbar-main-collapse"><ul class="nav navbar-nav"><li><a href="/blog" class="page-scroll">Blog ðŸ”¨</a></li><li><a href="/#about" class="page-scroll">Projects âš¡</a></li></ul></div></div></nav><main id="content"><div id="archive" class="container"><div class="row"> <div class="col-sm-2 col-md-2"><h3>Categories</h3><a href="/blog"><p>All</p></a><a href="/categories/Career"><p>Career</p></a><a href="/categories/Programming"><p>Programming</p></a><a href="/categories/Javascript"><p>Javascript</p></a><a href="/categories/Laravel"><p>Laravel</p></a><a href="/categories/Cloud"><p>Cloud</p></a><a href="/categories/PHP"><p>PHP</p></a></div><div class="col-xs-12 col-md-8"><article class="post"><div class="row"><div class="col-md-10 col-md-offset-1"><h1 class="post-title">Use Express, Angular 1.x and JWT to make a secure app</h1></div></div><div class="row"><div class="post-meta"><h5><span>Connor Leech</span><span class="date"> - Oct 23, 2015&ensp;in<span class="post-categories">&ensp;<a href="/categories/Javascript/" class="post-category">Javascript</a></span></span></h5><a target="_blank" href="http://twitter.com/intent/tweet?status=Use Express, Angular 1.x and JWT to make a secure app by @Connor11528+http://connorleech.info/blog/use-express-angular-and-jwt-to-make-a-secure-app/" class="btn btn-primary social-share twitter"><i class="fa fa-twitter fa-2x"><span class="hidden-xs"></span></i></a><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://connorleech.info/blog/use-express-angular-and-jwt-to-make-a-secure-app/&amp;title=Use Express, Angular 1.x and JWT to make a secure app&amp;source=connorleech.info" class="btn btn-primary social-share linkedin"><i class="fa fa-linkedin fa-2x"><span class="hidden-xs"></span></i></a></div></div><div class="post-body"><p>Master authentication with fullstack javascript development</p>
<p><img src="http://media.giphy.com/media/3oEduWAFQjlfP5gMU0/giphy.gif" alt=""></p>
<p><a href="https://node-jwt-intro.herokuapp.com/" target="_blank" rel="noopener">DEMO</a></p>
<p><a href="https://github.com/connor11528/node-jwt-intro" target="_blank" rel="noopener">SOURCE CODE</a></p>
<h3 id="Build-server"><a href="#Build-server" class="headerlink" title="Build server"></a>Build server</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">https</span>://github.com/connor11528/mean-starter</span><br></pre></td></tr></table></figure>
<p>Install some more packages:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">install </span><span class="keyword">jsonwebtoken </span><span class="keyword">bcrypt </span>q --save</span><br></pre></td></tr></table></figure>
<p>In <strong>server.js</strong> add a secret key. We will use the secret key to encrypt and decrypt the Json Web Tokens (JWTs).</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JWT config</span></span><br><span class="line"><span class="keyword">var</span> jwtSecret = <span class="string">'thupers3crT$12'</span>;</span><br><span class="line">app.<span class="keyword">set</span>(<span class="string">'superSecret'</span>, jwtSecret);</span><br></pre></td></tr></table></figure>
<p>Create a user schema in <strong>server/models/user.js</strong>:</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> mongoose = <span class="keyword">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="built_in">var</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">// email, pwd are required</span></span><br><span class="line"><span class="comment">// email must be unique</span></span><br><span class="line"><span class="comment">// don't send password with requests</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">var</span> userSchema = <span class="literal">new</span> Schema(&#123;</span><br><span class="line">	email: &#123;<span class="keyword">type</span>: <span class="built_in">String</span>, required: <span class="literal">true</span>, unique: <span class="literal">true</span> &#125;,</span><br><span class="line">	password: &#123;<span class="keyword">type</span>: <span class="built_in">String</span>, required: <span class="literal">true</span>, <span class="keyword">select</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">	admin: <span class="built_in">Boolean</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = mongoose.model(<span class="string">'User'</span>, userSchema);</span><br></pre></td></tr></table></figure>
<p>Like the comments say, email and passwords are required, emails must be unique and donâ€™t send the password with the request. We are going to hash user passwords but it is still good practice to not expose that.</p>
<p><em>Hash password:</em> we are going to have a util for hashing and decrypting passwords. We will have these methods in <strong>server/utils.js</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bcrypt = <span class="built_in">require</span>(<span class="string">'bcrypt'</span>),</span><br><span class="line">	q = <span class="built_in">require</span>(<span class="string">'q'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// helper function for hashing users' passwords</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	comparePwd: <span class="function"><span class="keyword">function</span>(<span class="params">password, hash</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> dfd = q.defer();</span><br><span class="line"></span><br><span class="line">		bcrypt.compare(password, hash, <span class="function"><span class="keyword">function</span>(<span class="params">err, isMatch</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err) dfd.reject(err);</span><br><span class="line"></span><br><span class="line">			dfd.resolve(isMatch);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> dfd.promise;</span><br><span class="line">	&#125;,</span><br><span class="line">	hashPwd: <span class="function"><span class="keyword">function</span>(<span class="params">password</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> dfd = q.defer();</span><br><span class="line">		bcrypt.genSalt(<span class="number">10</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, salt</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err) dfd.reject(err);</span><br><span class="line"></span><br><span class="line">		    bcrypt.hash(password, salt, <span class="function"><span class="keyword">function</span>(<span class="params">err, hash</span>) </span>&#123;</span><br><span class="line">		    	<span class="keyword">if</span>(err) dfd.reject(err);</span><br><span class="line"></span><br><span class="line">		    	dfd.resolve(hash);</span><br><span class="line">		    &#125;);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> dfd.promise;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>set up routes in <strong>server/routes.js</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>),</span><br><span class="line">	path = <span class="built_in">require</span>(<span class="string">'path'</span>),</span><br><span class="line">	jwt = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>),</span><br><span class="line">	utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>),</span><br><span class="line">	rootPath = path.normalize(__dirname + <span class="string">'/../'</span>),</span><br><span class="line">	apiRouter = express.Router(),</span><br><span class="line">	User = <span class="built_in">require</span>(<span class="string">'./models/user'</span>),</span><br><span class="line">	router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app</span>)</span>&#123;	</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>Then make an api endpoint to add a user:</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add user</span></span><br><span class="line">	apiRouter.post(<span class="string">'/users'</span>, <span class="function"><span class="keyword">function</span></span>(req, res)&#123;</span><br><span class="line"></span><br><span class="line">		utils.hashPwd(req.body.password).then(<span class="function"><span class="keyword">function</span></span>(hashedPwd)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">var</span> <span class="keyword">new</span><span class="type">User</span> = <span class="keyword">new</span> <span class="type">User</span>(&#123;</span><br><span class="line">				email: <span class="type">req</span>.body.email,</span><br><span class="line">				password: <span class="type">hashedPwd</span>,</span><br><span class="line">				admin: <span class="type">false</span></span><br><span class="line"><span class="type">			</span>&#125;);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">new</span><span class="type">User</span>.save(<span class="function"><span class="keyword">function</span></span>(err)&#123;</span><br><span class="line">				<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// create token</span></span><br><span class="line">				<span class="keyword">var</span> token = jwt.sign(<span class="keyword">new</span><span class="type">User</span>, app.<span class="keyword">get</span>(<span class="string">'superSecret'</span>), &#123; expiresInminutes: <span class="type">1440 </span>&#125;);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">new</span><span class="type">User</span>.password = undefined;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// send token</span></span><br><span class="line">				res.json(&#123;</span><br><span class="line">					success: <span class="type">true</span>,</span><br><span class="line">					message: <span class="type"></span>'Successfully authenticated!<span class="string">',</span></span><br><span class="line"><span class="string">					token: token,</span></span><br><span class="line"><span class="string">					user: newUser</span></span><br><span class="line"><span class="string">				&#125;);</span></span><br><span class="line"><span class="string">			&#125;);</span></span><br><span class="line"><span class="string">		&#125;);</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">	&#125;);</span></span><br></pre></td></tr></table></figure>
<p>We create the user in the database, create a token and send that. Authenticate a user with this route:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// authenticate user</span></span><br><span class="line">apiRouter.post(<span class="string">'/users/auth'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// add back the password field for this query</span></span><br><span class="line">	<span class="keyword">var</span> query = User.findOne(&#123;</span><br><span class="line">		email: req.body.email</span><br><span class="line">	&#125;).select(<span class="string">'_id email +password'</span>);</span><br><span class="line"></span><br><span class="line">	query.exec(<span class="function"><span class="keyword">function</span><span class="params">(err, user)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!user)&#123;</span><br><span class="line">			res.json(&#123; success: <span class="literal">false</span>, message: <span class="string">'No user with that email'</span> &#125;);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(user)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// check password</span></span><br><span class="line">			utils.comparePwd(req.body.password, user.password).then(<span class="function"><span class="keyword">function</span><span class="params">(isMatch)</span></span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(!isMatch)&#123;</span><br><span class="line">					res.json(&#123; success: <span class="literal">false</span>, message: <span class="string">'Wrong password'</span> &#125;);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// create token</span></span><br><span class="line">					<span class="keyword">var</span> token = jwt.sign(user, app.get(<span class="string">'superSecret'</span>), &#123; expiresInminutes: <span class="number">1440</span> &#125;);</span><br><span class="line"></span><br><span class="line">					user.password = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// send token</span></span><br><span class="line">					res.json(&#123;</span><br><span class="line">						success: <span class="literal">true</span>,</span><br><span class="line">						message: <span class="string">'Successfully authenticated!'</span>,</span><br><span class="line">						token: token,</span><br><span class="line">						user: user</span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Then weâ€™re going to have an endpoint to show all the users, but we are going to protect it with some middleware, namely an <code>authenticate</code> function.</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apiRouter.get(<span class="string">'/users'</span>, authenticate, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</span><br><span class="line">		User.<span class="built_in">find</span>(&#123;&#125;, <span class="function"><span class="keyword">function</span><span class="params">(err, users)</span></span>&#123;</span><br><span class="line">			res.json(users);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
<p>That function is defined as such:</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// middleware</span></span><br><span class="line">	function authenticate(req, res, next)&#123;</span><br><span class="line">	  <span class="keyword">var</span> <span class="keyword">token</span> = req.body.<span class="keyword">token</span> || req.<span class="keyword">query</span>.<span class="keyword">token</span> || req.headers['x-access-<span class="keyword">token</span>'];</span><br><span class="line"></span><br><span class="line">	  <span class="keyword">if</span> (<span class="keyword">token</span>) &#123;</span><br><span class="line"></span><br><span class="line">	  	<span class="comment">// verify token validity</span></span><br><span class="line">	    jwt.verify(<span class="keyword">token</span>, <span class="keyword">app</span>.<span class="built_in">get</span>('superSecret'), function(<span class="keyword">err</span>, decoded) &#123;      </span><br><span class="line">	      <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</span><br><span class="line">	        <span class="keyword">return</span> res.json(&#123; success: false, message: 'Failed to authenticate <span class="keyword">token</span>.' &#125;);    </span><br><span class="line">	      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	        req.decoded = decoded;    </span><br><span class="line">	        next();</span><br><span class="line">	      &#125;</span><br><span class="line">	    &#125;);</span><br><span class="line"></span><br><span class="line">	  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">return</span> res.status(403).send(&#123; </span><br><span class="line">	        success: false, </span><br><span class="line">	        message: '<span class="keyword">No</span> <span class="keyword">token</span> provided.' </span><br><span class="line">	    &#125;);</span><br><span class="line">	    </span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>Thatâ€™s all the server setup. Next we will deploy the app to heroku.</p>
<h3 id="Deploy-to-heroku"><a href="#Deploy-to-heroku" class="headerlink" title="Deploy to heroku"></a>Deploy to heroku</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ heroku create &lt;app_name&gt;</span><br><span class="line">$ heroku config:<span class="builtin-name">set</span> <span class="attribute">NODE_ENV</span>=production</span><br><span class="line">$ heroku addons:create mongolab:sandbox </span><br><span class="line">$ heroku<span class="built_in"> config </span>| grep MONGOLAB_URI</span><br></pre></td></tr></table></figure>
<p>Add the mongolab uri to <strong>server/env.js</strong>. Then commit the change.
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push heroku master</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> heroku ps:scale web=1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Build-client"><a href="#Build-client" class="headerlink" title="Build client"></a>Build client</h3><p>Include libraries in <strong>public/index.html</strong>. We are going to use <a href="https://github.com/formly-js/angular-formly" target="_blank" rel="noopener">angular-formly</a> to keep things fresh. It also means we write more javascript and less html. woohoo!</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- angular + router + bootstrap --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.15/angular-ui-router.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- angular-formly + dependency --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/api-check/7.5.0/api-check.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/angular-formly/6.21.1/formly.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/angular-formly-templates-bootstrap/6.0.0/angular-formly-templates-bootstrap.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- our custom js --&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><img src="http://media.giphy.com/media/QgpbrXUVhJqzm/giphy.gif" alt=""></p>
<p>Here is the module definition in <strong>public/js/app.js</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'jwtintro'</span>, [</span><br><span class="line">	<span class="string">'ui.router'</span>,</span><br><span class="line">	<span class="string">'formly'</span>,</span><br><span class="line">	<span class="string">'formlyBootstrap'</span></span><br><span class="line">], <span class="function"><span class="keyword">function</span><span class="params">($httpProvider)</span></span>&#123;</span><br><span class="line">	<span class="comment">// will add token to header of requests if token is present</span></span><br><span class="line">	$httpProvider.interceptors.push(<span class="string">'authInterceptor'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.run(<span class="function"><span class="keyword">function</span><span class="params">($rootScope, auth)</span></span>&#123;</span><br><span class="line">	<span class="comment">// if the user's data is in local storage</span></span><br><span class="line">	<span class="comment">// show them as signed in</span></span><br><span class="line">	<span class="keyword">var</span> user = auth.getUser();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(user)&#123;</span><br><span class="line">		$rootScope.user = JSON.parse(user);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.constant(<span class="string">'API_URL'</span>, <span class="string">'api/'</span>);</span><br><span class="line"></span><br><span class="line">app.config(<span class="function"><span class="keyword">function</span><span class="params">($stateProvider, $urlRouterProvider)</span></span>&#123;</span><br><span class="line">	$stateProvider</span><br><span class="line">		.state(<span class="string">'home'</span>, &#123;</span><br><span class="line">			url: <span class="string">"/"</span>,</span><br><span class="line">			templateUrl: <span class="string">"templates/main.html"</span>,</span><br><span class="line">			controller: <span class="string">'MainCtrl'</span></span><br><span class="line">		&#125;)</span><br><span class="line">		.state(<span class="string">'auth'</span>, &#123;</span><br><span class="line">			<span class="keyword">abstract</span>: <span class="keyword">true</span>,</span><br><span class="line">			templateUrl: <span class="string">'templates/auth/main.html'</span></span><br><span class="line">		&#125;)</span><br><span class="line">		.state(<span class="string">'auth.login'</span>, &#123;</span><br><span class="line">			url: <span class="string">"/login"</span>,</span><br><span class="line">			templateUrl: <span class="string">"templates/auth/login.html"</span>,</span><br><span class="line">			controller: <span class="string">'LoginCtrl'</span></span><br><span class="line">		&#125;)</span><br><span class="line">		.state(<span class="string">'auth.register'</span>, &#123;</span><br><span class="line">			url: <span class="string">"/register"</span>,</span><br><span class="line">			templateUrl: <span class="string">"templates/auth/register.html"</span>,</span><br><span class="line">			controller: <span class="string">'RegisterCtrl'</span></span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">	$urlRouterProvider.otherwise(<span class="string">"/"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Bet you did not know that there is a third argument to module definitions. I did not. You like that nifty abstract state? Shit is cray. Alright moving on, controllers look like:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">app.controller(<span class="string">'LoginCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($rootScope, $scope, user, $state)</span></span>&#123;</span><br><span class="line">	$scope.userCreds = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	$scope.loginFields = [</span><br><span class="line">		&#123; </span><br><span class="line">			type: <span class="string">'input'</span>,</span><br><span class="line">			key: <span class="string">'email'</span>,</span><br><span class="line">			templateOptions: &#123;</span><br><span class="line">				label: <span class="string">'Email'</span>,</span><br><span class="line">				type: <span class="string">'email'</span>,</span><br><span class="line">				placeholder: <span class="string">'Valid email address'</span>,</span><br><span class="line">				required: <span class="keyword">true</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123; </span><br><span class="line">			type: <span class="string">'input'</span>,</span><br><span class="line">			key: <span class="string">'password'</span>,</span><br><span class="line">			templateOptions: &#123;</span><br><span class="line">				label: <span class="string">'Password'</span>,</span><br><span class="line">				type: <span class="string">'password'</span>,</span><br><span class="line">				placeholder: <span class="string">'Password'</span>,</span><br><span class="line">				required: <span class="keyword">true</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	];</span><br><span class="line"></span><br><span class="line">	$scope.login = <span class="function"><span class="keyword">function</span><span class="params">(userCreds)</span></span>&#123;</span><br><span class="line">		user.login(userCreds).then(<span class="function"><span class="keyword">function</span> <span class="title">success</span><span class="params">(res)</span></span>&#123;</span><br><span class="line">			<span class="comment">// if successful, log user in</span></span><br><span class="line">			<span class="keyword">if</span>(res.data.success)&#123;</span><br><span class="line">				$rootScope.user = res.data.user;</span><br><span class="line">				$state.go(<span class="string">'home'</span>);</span><br><span class="line">			&#125;	</span><br><span class="line">		&#125;, <span class="function"><span class="keyword">function</span> <span class="title">handleError</span><span class="params">(res)</span></span>&#123;</span><br><span class="line">			console.error(<span class="string">'Error: '</span> + JSON.stringify(res.data));</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	$scope.logout = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">		$rootScope.user = <span class="keyword">null</span>;</span><br><span class="line">		user.logout();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// hard page refresh</span></span><br><span class="line">		$state.go($state.current.name, $state.params, &#123; reload: <span class="keyword">true</span> &#125;);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.controller(<span class="string">'RegisterCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($rootScope, $scope, user, $state)</span></span>&#123;</span><br><span class="line">	$scope.newUser = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	$scope.registerFields = [</span><br><span class="line">		&#123; </span><br><span class="line">			type: <span class="string">'input'</span>,</span><br><span class="line">			key: <span class="string">'email'</span>,</span><br><span class="line">			templateOptions: &#123;</span><br><span class="line">				label: <span class="string">'Email'</span>,</span><br><span class="line">				type: <span class="string">'email'</span>,</span><br><span class="line">				placeholder: <span class="string">'Valid email address'</span>,</span><br><span class="line">				required: <span class="keyword">true</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123; </span><br><span class="line">			type: <span class="string">'input'</span>,</span><br><span class="line">			key: <span class="string">'password'</span>,</span><br><span class="line">			templateOptions: &#123;</span><br><span class="line">				label: <span class="string">'Password'</span>,</span><br><span class="line">				type: <span class="string">'password'</span>,</span><br><span class="line">				placeholder: <span class="string">'8 characters, number and special symbol'</span>,</span><br><span class="line">				required: <span class="keyword">true</span></span><br><span class="line">			&#125;,</span><br><span class="line">			validators: &#123;</span><br><span class="line">				checker: <span class="function"><span class="keyword">function</span><span class="params">($viewValue, $modelValue, scope)</span></span>&#123;</span><br><span class="line">					<span class="keyword">var</span> attemptedPwd = $viewValue || $modelValue;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">var</span> REQUIRED_PATTERNS = [</span><br><span class="line">					    /\d+/,    <span class="comment">//numeric values</span></span><br><span class="line">					    /[a-z]+/, <span class="comment">//lowercase values</span></span><br><span class="line">					    /[A-Z]+/, <span class="comment">//uppercase values</span></span><br><span class="line">					    /\W+/,    <span class="comment">//special characters</span></span><br><span class="line">					    /^\S+$/   <span class="comment">//no whitespace allowed</span></span><br><span class="line">					];</span><br><span class="line">					<span class="keyword">var</span> status = <span class="keyword">true</span>;</span><br><span class="line">					angular.<span class="keyword">forEach</span>(REQUIRED_PATTERNS, <span class="function"><span class="keyword">function</span><span class="params">(pattern)</span> </span>&#123;</span><br><span class="line">						<span class="comment">// check that the attempted password passes all tests</span></span><br><span class="line">						status = status &amp;&amp; pattern.test(attemptedPwd);</span><br><span class="line">					&#125;);</span><br><span class="line"></span><br><span class="line">					<span class="comment">// must be at least eight characters</span></span><br><span class="line">					<span class="keyword">return</span> (status &amp;&amp; attemptedPwd.length &gt;= <span class="number">8</span>)? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	];</span><br><span class="line"></span><br><span class="line">	$scope.register = <span class="function"><span class="keyword">function</span><span class="params">(newUser)</span></span>&#123;</span><br><span class="line">		user.register(newUser).then(<span class="function"><span class="keyword">function</span> <span class="title">success</span><span class="params">(res)</span></span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(res.data.success)&#123;</span><br><span class="line">				$rootScope.user = res.data.user;</span><br><span class="line">				$state.go(<span class="string">'home'</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, handleError);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">handleError</span><span class="params">(res)</span></span>&#123;</span><br><span class="line">		alert(<span class="string">'Error: '</span> + res.data);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>public/js/factories/auth.js</strong>:
Here we are going to store the user data and the token in the browserâ€™s localStorage. We also define this funky httpInterceptor business. request is a special keyword. It acts similar to express middleware.
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stores and removes jwt and user data</span></span><br><span class="line"><span class="comment">// from browser's local storage </span></span><br><span class="line"></span><br><span class="line">app.factory(<span class="string">'auth'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$window</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> store = $<span class="built_in">window</span>.localStorage;</span><br><span class="line">	<span class="keyword">var</span> key = <span class="string">'node-jwt-intro-auth-token'</span>;</span><br><span class="line">	<span class="keyword">var</span> userKey = <span class="string">'node-jwt-intro-user'</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		getToken: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> store.getItem(key);</span><br><span class="line">		&#125;,</span><br><span class="line">		setToken: <span class="function"><span class="keyword">function</span>(<span class="params">token</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(token)&#123;</span><br><span class="line">				store.setItem(key, token);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				store.removeItem(key);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		getUser: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> store.getItem(userKey);</span><br><span class="line">		&#125;,</span><br><span class="line">		setUser: <span class="function"><span class="keyword">function</span>(<span class="params">user</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(user)&#123;</span><br><span class="line">				store.setItem(userKey, <span class="built_in">JSON</span>.stringify(user));</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				store.removeItem(userKey);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// if the user has logged in add a special header</span></span><br><span class="line">app.factory(<span class="string">'authInterceptor'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">auth</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		request: <span class="function"><span class="keyword">function</span>(<span class="params">config</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> token = auth.getToken();</span><br><span class="line">			<span class="keyword">if</span>(token)&#123;</span><br><span class="line">				<span class="comment">// add custom header to every request when user has token</span></span><br><span class="line">				config.headers = config.headers || &#123;&#125;;</span><br><span class="line">				config.headers[<span class="string">'x-access-token'</span>] = token;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> config;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>In the user facory we will send requests for login, logout and register <strong>public/js/factories/user.js</strong>:</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">app.factory(<span class="string">'user'</span>, <span class="function"><span class="keyword">function</span><span class="params">($http, auth, API_URL)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		login: <span class="function"><span class="keyword">function</span><span class="params">(userCreds)</span></span>&#123;</span><br><span class="line">			<span class="keyword">return</span> $http.post(API_URL + <span class="string">'users/auth'</span>, &#123;</span><br><span class="line">				email: userCreds.email,</span><br><span class="line">				password: userCreds.password</span><br><span class="line">			&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span><br><span class="line">				auth.setToken(res.<span class="keyword">data</span>.token);</span><br><span class="line">				auth.setUser(res.<span class="keyword">data</span>.user);</span><br><span class="line">				<span class="keyword">return</span> res;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;,</span><br><span class="line">		register: <span class="function"><span class="keyword">function</span><span class="params">(newUser)</span></span>&#123;</span><br><span class="line">			// create user</span><br><span class="line">			<span class="keyword">return</span> $http.post(API_URL + <span class="string">'users'</span>, &#123;</span><br><span class="line">				email: newUser.email,</span><br><span class="line">				password: newUser.password</span><br><span class="line">			&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span><br><span class="line">				// <span class="built_in">log</span> user <span class="keyword">in</span></span><br><span class="line">				auth.setToken(res.<span class="keyword">data</span>.token);</span><br><span class="line">				auth.setUser(res.<span class="keyword">data</span>.user);</span><br><span class="line">				<span class="keyword">return</span> res;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;,</span><br><span class="line">		logout: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">			auth.setToken();</span><br><span class="line">			auth.setUser();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Now for the templates. Hereâ€™s the abstract one in <strong>public/templates/auth/main.html</strong>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'text-center'</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn-group btn-group-justified"</span> <span class="attr">role</span>=<span class="string">"group"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"auth.login"</span> <span class="attr">ui-sref-active</span>=<span class="string">'active'</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">role</span>=<span class="string">"button"</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"auth.register"</span> <span class="attr">ui-sref-active</span>=<span class="string">'active'</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">role</span>=<span class="string">"button"</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'col-sm-6 col-sm-offset-3'</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">ui-view</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>and then the login and register angular-formly layouts are minimal.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">'loginForm'</span> <span class="attr">ng-submit</span>=<span class="string">'login(userCreds)'</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">formly-form</span> <span class="attr">model</span>=<span class="string">'userCreds'</span> <span class="attr">fields</span>=<span class="string">'loginFields'</span> <span class="attr">form</span>=<span class="string">'loginForm'</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span> <span class="attr">class</span>=<span class="string">'btn btn-primary'</span> <span class="attr">ng-disabled</span>=<span class="string">"loginForm.$invalid"</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">formly-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>andâ€¦</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>Create a new account<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">'registerForm'</span> <span class="attr">ng-submit</span>=<span class="string">'register(newUser)'</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">formly-form</span> <span class="attr">model</span>=<span class="string">'newUser'</span> <span class="attr">fields</span>=<span class="string">'registerFields'</span> <span class="attr">form</span>=<span class="string">'registerForm'</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span> <span class="attr">class</span>=<span class="string">'btn btn-success'</span> <span class="attr">ng-disabled</span>=<span class="string">"registerForm.$invalid"</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">formly-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>That is pretty much it. It is worth noting any app can send these requests to this server. The server sends and validates tokens. The server does not need to maintain sessions. The browserâ€™s localStorage is also really helpful with this examples. If you have questions <a href="https://twitter.com/connor11528" target="_blank" rel="noopener">hit me up on twitter</a>.</p>
</div><div id="disqus_thread"></div></article><nav class="pagination"><a href="/blog/Build-push-notifications-into-an-ionic-app/" title="Build push notifications into an Ionic 1.x app" class="btn-default entry-pagination__link entry-pagination__link--prev">Prev</a><a href="/blog/Create-a-starter-template-for-working-with-django-rest-framework/" title="Create a starter template for working with django-rest-framework" class="btn-default entry-pagination__link entry-pagination__link--next">Next</a></nav></div></div></div></main><footer class="footer"><div class="container"><div class="row"><div class="col-sm-6"><h4>Connor's Dev Newsletter</h4><p>Very occassional updates. You're free to sign up.</p><ul><li><form action="//herokuapp.us14.list-manage.com/subscribe/post?u=42dd73a709fbadb4a29ef1d0d&amp;amp;id=b77fdad58d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate="" class="validate"><div class="input-group"><input type="email" value="" name="EMAIL" id="mce-EMAIL" placeholder="Enter your email here" class="required email form-control input-lg"><div id="mce-error-response" style="display:none" class="response"></div><div id="mce-success-response" style="display:none" class="response"></div><div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_42dd73a709fbadb4a29ef1d0d_b77fdad58d" tabindex="-1" value=""></div><span class="input-group-btn"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn btn-primary btn-lg"></span></div></form></li></ul></div><div class="col-sm-2 col-sm-offset-1"><h4>Connect</h4><ul><li> <a target="_blank" href="https://github.com/connor11528">GitHub</a></li><li> <a target="_blank" href="https://www.linkedin.com/in/connorleech">LinkedIn</a></li><li> <a target="_blank" href="https://twitter.com/connor11528">Twitter</a></li><li><a target="_blank" href="https://medium.com/@connorleech">Medium</a></li><li><a target="_blank" href="https://stackoverflow.com/users/2031033/connor-leech">Stackoverflow</a></li><li><a target="_blank" href="https://plus.google.com/u/0/+ConnorLeech">Google+</a></li></ul></div><div class="col-sm-3"><h4>Email</h4><ul><li> <a href="mailto:connorleech@gmail.com">connorleech@gmail.com</a></li></ul></div></div></div></footer><!-- vendor--><script src="/bower_components/jquery/dist/jquery.min.js"></script><script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/bower_components/wow/dist/wow.min.js"></script><script src="/bower_components/jquery-easing/jquery.easing.min.js"></script><script src="/bower_components/jquery-color/jquery.color.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/ScrollMagic.min.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/plugins/debug.addIndicators.min.js"></script><script src="/bower_components/vivus/dist/vivus.min.js"></script><!-- require modules--><script src="/js/require.js"></script><script src="/js/app.js"></script><!-- analytics--><!-- disqus--><script>(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://connorleech.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></body></html>